config global 'global'
	option class_bulk 'le'
	option class_high_throughput 'af13'
	option client_hints '1'
	option threaded_client_min_bytes '10000'
	option threaded_service_min_bytes '1000000'
	option wmm '0'

config ipset
	option name 'doh-set'
	option match 'ip'
	entry '8.8.8.8'					# Google
	entry '8.8.4.4'					# Google
	entry '1.1.1.1'					# Cloudflare
	entry '1.0.0.1'					# Cloudflare
	entry '9.9.9.9'					# Quad9 Secured
	entry '149.112.112.112'			# Quad9 Secured
	entry '9.9.9.11'				# Quad9 Secured w/ECS
	entry '149.112.112.11'			# Quad9 Secured w/ECS
	entry '94.140.14.0/24'			# AdGuard
	entry '2001:4860:4860::8888' 	# Google
	entry '2001:4860:4860::8844' 	# Google
	entry '2606:4700:4700::1111' 	# Cloudflare
	entry '2606:4700:4700::1001'	# Cloudflare
	entry '2620:fe::fe'				# Quad9 Secured
	entry '2620:fe::9'				# Quad9 Secured
	entry '2620:fe::11'				# Quad9 Secured w/ECS
	entry '2620:fe::fe:11'			# Quad9 Secured w/ECS
	entry '2a10:50c0::ad1:ff'		# AdGuard
	entry '2a10:50c0::ad2:ff'		# AdGuard
	entry '2a10:50c0::ded:ff'		# AdGuard Dedicated

config ipset
	option name 'xcloud-set'
	option match 'ip'
	entry '13.104.0.0/14' # Western Europe
	entry '2603:1000::/24' # Western Europe

config ipset
	option name 'discord-set'
	option match 'ip'
	entry '66.22.196.0/22' # Rotterdam, EU - discord-nlrtm1-1
	entry '66.22.204.0/22' # Chicago, US - discord-uschi1-1
	entry '66.22.246.0/24' # Brazil, BR - discord-brcoa1-2

config ipset
	option name 'teams-set'
	option match 'ip'
	entry '13.107.64.0/18'
	entry '52.112.0.0/14'
	entry '52.122.0.0/15'
	entry '2603:1063::/38'

# referenced from https://assets.zoom.us/docs/ipranges/ZoomMeetings.txt
config ipset
	option name 'zoom-set'
	option match 'ip'
	entry '2407:30C0::/32'
	entry '2600:9000:2600::/48'
	entry '2620:123:2000::/40'
	entry '3.7.35.0/25'
	entry '3.21.137.128/25'
	entry '3.25.41.128/25'
	entry '3.80.20.128/25'
	entry '3.96.19.0/24'
	entry '3.101.52.0/25'
	entry '3.104.34.128/25'
	entry '3.120.121.0/25'
	entry '3.127.194.128/25'
	entry '3.208.72.0/25'
	entry '3.211.241.0/25'
	entry '3.235.71.128/25'
	entry '3.235.72.128/25'
	entry '3.235.73.0/25'
	entry '3.235.82.0/23'
	entry '3.235.96.0/23'
	entry '4.34.125.128/25'
	entry '4.35.64.128/25'
	entry '8.5.128.0/23'
	entry '13.52.6.128/25'
	entry '13.52.146.0/25'
	entry '15.220.80.0/24'
	entry '15.220.81.0/25'
	entry '16.63.29.0/24'
	entry '16.63.30.0/24'
	entry '18.157.88.0/24'
	entry '18.205.93.128/25'
	entry '18.254.23.128/25'
	entry '18.254.61.0/25'
	entry '20.203.158.80/28'
	entry '20.203.190.192/26'
	entry '50.239.202.0/23'
	entry '50.239.204.0/24'
	entry '52.61.100.128/25'
	entry '52.202.62.192/26'
	entry '52.215.168.0/25'
	entry '64.125.62.0/24'
	entry '64.211.144.0/24'
	entry '64.224.32.0/19'
	entry '65.39.152.0/24'
	entry '69.174.57.0/24'
	entry '69.174.108.0/22'
	entry '99.79.20.0/25'
	entry '101.36.167.0/24'
	entry '101.36.170.0/23'
	entry '103.122.166.0/23'
	entry '111.33.115.0/25'
	entry '111.33.181.0/25'
	entry '115.110.154.192/26'
	entry '115.114.56.192/26'
	entry '115.114.115.0/26'
	entry '115.114.131.0/26'
	entry '120.29.148.0/24'
	entry '129.151.1.128/27'
	entry '129.151.1.192/27'
	entry '129.151.2.0/27'
	entry '129.151.3.160/27'
	entry '129.151.7.96/27'
	entry '129.151.11.64/27'
	entry '129.151.11.128/27'
	entry '129.151.12.0/27'
	entry '129.151.13.64/27'
	entry '129.151.15.224/27'
	entry '129.151.16.0/27'
	entry '129.151.31.224/27'
	entry '129.151.40.0/25'
	entry '129.151.40.160/27'
	entry '129.151.40.192/27'
	entry '129.151.41.0/25'
	entry '129.151.41.192/26'
	entry '129.151.42.0/27'
	entry '129.151.42.64/27'
	entry '129.151.42.128/26'
	entry '129.151.42.224/27'
	entry '129.151.43.0/27'
	entry '129.151.43.64/26'
	entry '129.151.48.0/27'
	entry '129.151.48.160/27'
	entry '129.151.49.0/26'
	entry '129.151.49.96/27'
	entry '129.151.49.128/27'
	entry '129.151.49.192/26'
	entry '129.151.50.0/27'
	entry '129.151.50.64/27'
	entry '129.151.52.128/26'
	entry '129.151.53.32/27'
	entry '129.151.53.224/27'
	entry '129.151.55.32/27'
	entry '129.151.56.32/27'
	entry '129.151.57.32/27'
	entry '129.151.60.192/27'
	entry '129.159.2.32/27'
	entry '129.159.2.192/27'
	entry '129.159.3.0/24'
	entry '129.159.4.0/23'
	entry '129.159.6.0/27'
	entry '129.159.6.96/27'
	entry '129.159.6.128/26'
	entry '129.159.6.192/27'
	entry '129.159.160.0/26'
	entry '129.159.160.64/27'
	entry '129.159.163.0/26'
	entry '129.159.163.160/27'
	entry '129.159.208.0/21'
	entry '129.159.216.0/26'
	entry '129.159.216.64/27'
	entry '129.159.216.128/26'
	entry '130.61.164.0/22'
	entry '132.226.176.0/25'
	entry '132.226.176.128/26'
	entry '132.226.177.96/27'
	entry '132.226.177.128/25'
	entry '132.226.178.0/27'
	entry '132.226.178.128/27'
	entry '132.226.178.224/27'
	entry '132.226.179.0/27'
	entry '132.226.179.64/27'
	entry '132.226.180.128/27'
	entry '132.226.183.160/27'
	entry '132.226.185.192/27'
	entry '134.224.0.0/16'
	entry '140.238.128.0/24'
	entry '140.238.232.0/22'
	entry '144.195.0.0/16'
	entry '147.124.96.0/19'
	entry '149.137.0.0/17'
	entry '150.230.224.0/25'
	entry '150.230.224.128/26'
	entry '150.230.224.224/27'
	entry '152.67.20.0/24'
	entry '152.67.118.0/24'
	entry '152.67.168.0/22'
	entry '152.67.180.0/24'
	entry '152.67.184.32/27'
	entry '152.67.240.0/21'
	entry '152.70.0.0/25'
	entry '152.70.0.128/26'
	entry '152.70.0.224/27'
	entry '152.70.1.0/25'
	entry '152.70.1.128/26'
	entry '152.70.1.192/27'
	entry '152.70.2.0/26'
	entry '152.70.7.192/27'
	entry '152.70.10.32/27'
	entry '152.70.224.32/27'
	entry '152.70.224.64/26'
	entry '152.70.224.160/27'
	entry '152.70.224.192/27'
	entry '152.70.225.0/25'
	entry '152.70.225.160/27'
	entry '152.70.225.192/27'
	entry '152.70.226.0/27'
	entry '152.70.227.96/27'
	entry '152.70.227.192/27'
	entry '152.70.228.0/27'
	entry '152.70.228.64/27'
	entry '152.70.228.128/27'
	entry '156.45.0.0/17'
	entry '158.101.64.0/24'
	entry '158.101.184.0/23'
	entry '158.101.186.0/25'
	entry '158.101.186.128/27'
	entry '158.101.186.192/26'
	entry '158.101.187.0/25'
	entry '158.101.187.160/27'
	entry '158.101.187.192/26'
	entry '159.124.0.0/16'
	entry '160.1.56.128/25'
	entry '161.199.136.0/22'
	entry '162.12.232.0/22'
	entry '162.255.36.0/22'
	entry '165.254.88.0/23'
	entry '166.108.64.0/18'
	entry '168.138.16.0/22'
	entry '168.138.48.0/24'
	entry '168.138.56.0/21'
	entry '168.138.72.0/24'
	entry '168.138.74.0/25'
	entry '168.138.80.0/25'
	entry '168.138.80.128/26'
	entry '168.138.80.224/27'
	entry '168.138.81.0/24'
	entry '168.138.82.0/23'
	entry '168.138.84.0/25'
	entry '168.138.84.128/27'
	entry '168.138.84.192/26'
	entry '168.138.85.0/24'
	entry '168.138.86.0/23'
	entry '168.138.96.0/22'
	entry '168.138.116.0/27'
	entry '168.138.116.64/27'
	entry '168.138.116.128/27'
	entry '168.138.116.224/27'
	entry '168.138.117.0/27'
	entry '168.138.117.96/27'
	entry '168.138.117.128/27'
	entry '168.138.118.0/27'
	entry '168.138.118.160/27'
	entry '168.138.118.224/27'
	entry '168.138.119.0/27'
	entry '168.138.119.128/27'
	entry '168.138.244.0/24'
	entry '170.114.0.0/16'
	entry '173.231.80.0/20'
	entry '192.204.12.0/22'
	entry '193.122.16.0/25'
	entry '193.122.16.192/27'
	entry '193.122.17.0/26'
	entry '193.122.17.64/27'
	entry '193.122.17.224/27'
	entry '193.122.18.32/27'
	entry '193.122.18.64/26'
	entry '193.122.18.160/27'
	entry '193.122.18.192/27'
	entry '193.122.19.0/27'
	entry '193.122.19.160/27'
	entry '193.122.19.192/27'
	entry '193.122.20.224/27'
	entry '193.122.21.96/27'
	entry '193.122.32.0/21'
	entry '193.122.40.0/22'
	entry '193.122.44.0/24'
	entry '193.122.45.32/27'
	entry '193.122.45.64/26'
	entry '193.122.45.128/25'
	entry '193.122.46.0/23'
	entry '193.122.208.96/27'
	entry '193.122.216.32/27'
	entry '193.122.222.0/27'
	entry '193.122.223.128/27'
	entry '193.122.226.160/27'
	entry '193.122.231.192/27'
	entry '193.122.232.160/27'
	entry '193.122.237.64/27'
	entry '193.122.244.160/27'
	entry '193.122.244.224/27'
	entry '193.122.245.0/27'
	entry '193.122.247.96/27'
	entry '193.122.252.192/27'
	entry '193.123.0.0/19'
	entry '193.123.40.0/21'
	entry '193.123.128.0/19'
	entry '193.123.168.0/21'
	entry '193.123.192.224/27'
	entry '193.123.193.0/27'
	entry '193.123.193.96/27'
	entry '193.123.194.96/27'
	entry '193.123.194.128/27'
	entry '193.123.194.224/27'
	entry '193.123.195.0/27'
	entry '193.123.196.0/27'
	entry '193.123.196.192/27'
	entry '193.123.197.0/27'
	entry '193.123.197.64/27'
	entry '193.123.198.64/27'
	entry '193.123.198.160/27'
	entry '193.123.199.64/27'
	entry '193.123.200.128/27'
	entry '193.123.201.32/27'
	entry '193.123.201.224/27'
	entry '193.123.202.64/27'
	entry '193.123.202.128/26'
	entry '193.123.203.0/27'
	entry '193.123.203.160/27'
	entry '193.123.203.192/27'
	entry '193.123.204.0/27'
	entry '193.123.204.64/27'
	entry '193.123.205.64/26'
	entry '193.123.205.128/27'
	entry '193.123.206.32/27'
	entry '193.123.206.128/27'
	entry '193.123.207.32/27'
	entry '193.123.208.160/27'
	entry '193.123.209.0/27'
	entry '193.123.209.96/27'
	entry '193.123.210.64/27'
	entry '193.123.211.224/27'
	entry '193.123.212.128/27'
	entry '193.123.215.192/26'
	entry '193.123.216.64/27'
	entry '193.123.216.128/27'
	entry '193.123.217.160/27'
	entry '193.123.219.64/27'
	entry '193.123.220.224/27'
	entry '193.123.222.64/27'
	entry '193.123.222.224/27'
	entry '198.251.128.0/17'
	entry '202.177.207.128/27'
	entry '204.80.104.0/21'
	entry '204.141.28.0/22'
	entry '206.247.0.0/16'
	entry '207.226.132.0/24'
	entry '209.9.211.0/24'
	entry '209.9.215.0/24'
	entry '213.19.144.0/24'
	entry '213.19.153.0/24'
	entry '213.244.140.0/24'
	entry '221.122.63.0/24'
	entry '221.122.64.0/24'
	entry '221.122.88.64/27'
	entry '221.122.88.128/25'
	entry '221.122.89.128/25'
	entry '221.123.139.192/27'

config rule
	option name 'DNS'
	list proto 'tcp'
	list proto 'udp'
	list dest_port '53'
	list dest_port '853'
	list dest_port '5353'
	option class 'cs5'

config rule
	option name 'DoH'
	list proto 'tcp'
	list proto 'udp'
	option ipset 'doh-set'
	list dest_port '443'
	option class 'cs5'

config rule
	option name 'BOOTP/DHCP'
	option proto 'udp'
	list dest_port '67'
	list dest_port '68'
	option class 'cs5'

config rule
	option name 'NTP'
	option proto 'udp'
	option dest_port '123'
	option class 'cs5'

config rule
	option name 'SSH'
	option proto 'tcp'
	option dest_port '22'
	option class 'cs2'

config rule
	option name 'Xbox Cloud Gaming'
	option proto 'udp'
	option ipset 'xcloud-set'
	list dest_port '1000-1150'
	list dest_port '9002'
	option class 'af41'

config rule
	option name 'VZW WiFi Calling'
	option proto 'udp'
	option dest_port '500'
	option dest_port '4500'
	option dest_ip '141.207.0.0/16'
	option class 'ef'

config rule
	option name 'Slack Huddles voice + video'
	option proto 'udp'
	option dest_port '22466'
	option dest_ip '99.77.128.0/18'
	option class 'af41'

config rule
	option name 'Apple FaceTime'
	list src_port '16384-16387'
	list src_port '16393-16402'
	list dest_ip '17.0.0.0/8'
	option class 'af41'

config rule
	option name 'Discord VoIP'
	option proto 'udp'
	option family 'ipv4'
	option ipset 'discord-set'
	option class 'ef'

config rule
	option name 'MS Teams voice'
	option proto 'udp'
	option src_port '50000-50019'
	option dest_port '3478-3481'
	option ipset 'teams-set'
	option class 'ef'

config rule
	option name 'MS Teams video'
	option proto 'udp'
	option src_port '50020-50039'
	option dest_port '3478-3481'
	option ipset 'teams-set'
	option class 'af41'

config rule
	option name 'MS Teams sharing'
	option proto 'udp'
	option src_port '50040-50059'
	option dest_port '3478-3481'
	option ipset 'teams-set'
	option class 'af21'

config rule
	option name 'Zoom Meetings v4'
	option proto 'udp'
	option dest_port '3478-3479'
	option dest_port '8801-8810'
	option ipset 'zoom-set'
	option class 'af41'

config rule
	option name 'ICMP'
	list proto 'icmp'
	list proto 'icmpv6'
	option class 'cs5'
	option enabled '0'

config rule # A rule which marks all non-HTTP UDP connections from a specific IP as cs4 and count new connection matches
	option name 'Game Console non-HTTP'
	option proto 'udp'
	list src_ip '192.168.1.100'
	list dest_port '!80'
	list dest_port '!443'
	option class 'cs4'
	option counter '1'
	option enabled '0'
